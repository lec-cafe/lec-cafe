# PHP における文字列操作

## PHP の文字列操作

文字列はシングルクォート `'hoge'`とダブルクォート `"hoge"`で囲むことで作ることができます。  
両者の違いは、文字列の中に「変数」や「エスケープシーケンス」が含まれている場合に出てきます。  
文字列の中で変数を展開して表示したい場合や、改行などの特殊文字を埋め込みたい場合にはダブルクォートで囲んだ文字列を使います。 

- "hoge"では変数やエスケープシーケンスが使用できます。
- 'hoge'では変数は `文字列`として扱われます。

ダブルクォートの中に変数を入れた場合
```php
<?php
$item = "M"; 
$price = 1500;
$msg = "$item サイズ, $price 円"; 
echo $msg;
?>
//出力
　 Mサイズ、1500円
```
シングルクォートの場合
```php
<?php
$item = "M"; 
$price = 1500;
$msg = '$item サイズ, $price 円'; 
echo $msg;
?>
//出力
　$item サイズ、$price 円 　//変数名がそのまま書き出されています
```
ドル記号を表示する  
ダブルクォートの中では `$`は変数名の接頭語と判断されるため、ドル記号$を表示するためにはエスケープシーケンスを使います。
```php
<?php
$yen = 117;
echo "今日のレートは、\$1 = $yen 円です。";
?>
//出力
　今日のレートは、 $1 = 117 円です。
```

### explode

- 文字列から配列を作る  
カンマや改行などで区切られた文字列から配列を作ることができます。利用するのはexplode()関数です。  
第一引数に区切り文字、第二引数に文字列を指定します。第３引数で最大個数を指定することもできます。

```php
<?php
//カンマで区切った名前リストから配列を作る
$data = "赤井一郎,伊藤　潤, 上野信行";
$delimiter = ",";
$nameList = explode($delimiter, $data);
print_r($nameList);
?>
//出力
Array
(
  [0] => 赤井一郎
  [1] => 伊藤　潤
  [2] => 上野信行
)
```

### implode

explode()の逆で配列の値を連結して一つの文字列にすることができます。配列の値は、指定した連結文字で連結された文字になります。
```php
<?php
//配列から文字列の名前リストを作る
$data = ["赤井一郎", "伊藤　潤", "上野信行"]; 
$glue = "さん、";
$nameList = implode($glue, $data); //値を取り出して「さん、」で連結
$nameList .= "さん";
print_r($nameList);
?>
//出力
赤井一郎さん、伊藤　潤さん、上野信行さん
```

- 復習
explode(文字列,"、") →　["A","B","C"]　配列にする  
implode("、",配列)　→　"A、B、C"　文字列にする

### nl2br

改行文字の前にHTMLの改行タグを挿入する場合にnl2br()関数を使います。  
第一引数は挿入する文字列、第二引数はXHTM　準拠の改行を使うか否か。指定しない場合\<br/>を挿入、falseを指定した場合\<br>を挿入
```php
<?php
$string = "This\nis\na\npen";
echo nl2br($string);
echo nl2br($string, false);
?>
//出力
This</br>
is</br>
a</br>
pen

This<br>
is<br>
a<br>
pen
```

### strpos

文字列内に指定した文字列が最初に現れる場所を取得する場合にstrpos()関数を使います。  
第一引数には検索対象の文字列、第二引数には検索する文字列、第３引数には文字列検索開始位置を指定する。第３引数を省略した場合は文字列の最初「0」から検索します。  
また失敗した場合は、falseを返します。日本語を検索する場合は、マルチバイト版のmb_strpos()を使いましょう。引数は同じ形で使用できます。
```php
<?php
$msg = "abcdefgd";
var_dump(strpos($msg, "d"));
var_dump(strpos($msg, "x"));
?>
//出力
int(3)
bool(false)
```

### str_replace

検索した文字を置換したい場合にはstr_replace()を使います。この関数はマルチバイト文字でも利用できます。  
英文字の大文字小文字を区別せずに検索置換したい場合にはstr_ireplace()を利用します。  
第一引数に検索する文字、第二引数に$replaceで置換する文字、第３引数で検索対象の文字列を指定します。第四引数に変数を指定すると置換された回数が入ります。  
検索した文字が複数個含まれるている場合には、全てが置換されます。
```php
<?php
//同じ文字列を使って別の語句に置換する
$subject = "我輩は猫である。";
echo str_replace("猫","犬", $subject), "\n"; //猫を犬に置換します
echo str_replace("猫","馬", $subject), "\n"; //猫を馬に置換します
echo $subject ;
?>
//出力
我輩は犬である。
我輩は馬である。
我輩は猫である。

```

### str_split

文字列を配列に置換したい場合にはstr_split()を使います。  
第一引数に配列に変換する文字列、第二引数に文字列を区切る長さを指定します。第二引数を指定しない場合(デフォルト)、一文字ずつ区切られます。
```php
<?php
$string = "Perl Ruby PHP";
print_r(str_split($string));
print_r(str_split($string,5));
?>
//出力
Array
(
    [0] => P
    [1] => e
    [2] => r
    [3] => l
    [4] =>  
    [5] => R
    [6] => u
    [7] => b
    [8] => y
    [9] =>  
    [10] => P
    [11] => H
    [12] => P
)
Array
(
    [0] => Perl 
    [1] => Ruby 
    [2] => PHP
)
```

### strtoupper

半角の英文字はstrtoupper()で小文字を大文字に変換することができます。
```php
<?php
$msg = "Apple iPhone";
echo strtoupper($msg);
?>
//出力
APPLE IPHONE
```

### strtolower

strtoupper()とは逆に大文字を小文字に変換するには、strtolower()を利用します。
```php
<?php
$msg = "Apple iPhone";
echo strtolower($msg);
?>
//出力
apple iphone
```

### mb_substr

文字列から途中の文字を取り出す場合はmb_substr()を使います。mb_substr(文字列,文字位置,文字数)、
mb_substr()では、第一引数に対象の文字列、第二引数に先頭文字の位置、第三引数に取り出す文字数を指定します。  
また、文字位置は0から数え1文字目が0になります。-1は最後の数字、-2は最後から二番目の文字をさします。  
mb_substr()を使って文字を取り出すということは、取り出さなかった文字は削除したと考えることができます。
```php
<?php
//　途中の文字を取り出す
$msg = "我輩は猫である。名前はまだない。";
echo mb_strlen($msg), "\n"; //文字数
echo mb_substr($msg,4), "\n"; //5文字目から最後まで
echo mb_substr($msg, 4, 10), "\n"; //5文字目から10文字
echo mb_substr($msg, -6), "\n"; //最後から6文字
?>
//出力
16
である。名前はまだない。
である。名前はまだな
はまだない。
```

半角英数字の文字列でもmb_strlen()、mb_substr()が使えますが、文字列が半角英数文字だけならば、文字数はstrlen()、文字の抜き出しにはsubstr()を利用できます。
```php
<?php
// 半角英数字だけの文字列から文字を抜き出す
$id = "ABC1X239JP";
echo strlen($id), "\n"; //文字数
echo substr($id, 4), "\n"; //5文字目から最後まで
echo substr($id, 5, 3), "\n"; //6文字目から3文字
echo sbustr($id, -2); //最後から2文字
?>
//出力
10
X239JP
239
JP
```

### trim

フォームに入力されたテキストの先頭や末尾には不要な空白や改行などが入っていることが考えられます。  
そこで、そういった不要な文字を取り除く関数があります。trim()が先頭と末尾、ltrim()が先頭(左側)、rtirm()は末尾(右側)の除去を行う関数です。  
次の例の$msgに入っている文字列には先頭にタブ、末尾に複数の空白に続いて改行が二個連続して入っています。trim()を使って取り除きます。
```php
<?php
$msg = "\tHello World!!  \n\n";
$result = trim($msg);
echo "処理前:\n";
echo "[", $msg, "]\n";
echo "処理後:\n";
echo "[", $result, "]\n";
?>
//出力
処理前: 
[　　Hello World!!

]
処理後:
[Hello World!!]
```

## PHPと正規表現

正規表現とは文字列をパターンで検索して、パターンにマッチするかどうかチェックする、置換する、分割するといった文字列処理を行う手法です。  
- 後置オプション  
後置オプションのパターン修飾子は、パターンの解析方法を指定するオプションです。パターン修飾子には以下のもの以外にもありますが、特に重要なのはu修飾子です。  
UTF-8エンコードのパターンには必ずu修飾子をつけるようにします。他に指定がない場合はu修飾子をつけておくよいでしょう。  
- i  
アルフベットの大文字、小文字を区別しない
- m  
行単位でマッチングする
- s  
ドット(.)で改行文字もマッチングする。
- u  
パターン文字をUTF-8エンコードで扱う。
- x  
パターンの中の空白文字を無視する(\s 、文字クラスないの空白を除く)

### preg_match

パターンマッチで利用する関数はpreg_match()です。preg_match()は第一引数にパターンの文字、第二引数に対象の文字列を指定して実行します。

```php
<?php
//探しているナンバーは46-49
$result1 = preg_match("/46-49/u", "確か49-46でした");
$result2 = preg_match("/46-49/u", "たぶん46-49でした");  //46-49が含まれている
$result3 = preg_match("/46-49u", "49-46"); //パターン式が間違っている
//結果
var_dump($result1);
var_dump($result2);
var_dump($result3);
?>
//出力
int(0)
int(1)
bool(false)
```
- 否定  
^は[^青]のように使い、「青」以外の文字にマッチします。
```php
<?php
//青木または赤木ではないときにマッチする
$pattern = "/[^青赤]木/u";
var_dump(preg_match($pattern, "大木"));
var_dump(preg_match($pattern, "青木"));
var_dump(preg_match($pattern, "赤木"));
var_dump(preg_match($pattern, "赤木、白木"));
?>
//出力
int(1)
int(0)
int(0)
int(1)
```
ハイフンは文字の範囲を示します。  
全ての数字は[0-9]、小文字のアルファベットは[a-z]、大文字ならば[A-Z]、すべてのアルファベットは[a-zA-Z]、英数字は[0-9a-zA-Z]のように文字クラスを定義します。
```php
<?php
//大文字 - 数字 - 英数字にマッチする
$pattern = "[A-F]-[0-9]-[0-9a-zA-Z]/u";
var_dump(preg_match($pattern, "A-5-5"));
var_dump(preg_match($pattern, "F-9-c"));
var_dump(preg_match($pattern, "G-17-10"));
var_dump(preg_match($pattern, "a-2-9"));
?>
//出力
int(1)
int(1)
int(0)
int(0)
```

## 参考リンク

https://www.php.net/manual/ja/ref.strings.php

mb string 系の関数は以下を確認してください。

https://www.php.net/manual/ja/book.mbstring.php
